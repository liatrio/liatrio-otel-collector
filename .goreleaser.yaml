---
# This is an example .goreleaser.yml file with some sensible defaults.
# Make sure to check the documentation at https://goreleaser.com
before:
    hooks:
    # You may remove this if you don't use go modules.
    # - go mod tidy
    # you may remove this if you don't need go generate
        - go generate ./...
        - make cibuild
builds:
    - dir: ./build
      env:
          - CGO_ENABLED=0
      goos:
          - linux
          - windows
          - darwin

        #dockers:
        #  - image_templates:
        #      - liatrio/{{ .ProjectName }}
dockers:
    - goos: linux
      goarch: '386'
      image_templates:
          - ghcr.io/liatrio/liatrio-otel-collector:{{ .Version }}-386
          - ghcr.io/liatrio/liatrio-otel-collector:latest-386
      extra_files:
          - testconfig/config.yaml
      build_flag_templates:
          - --pull
          - --platform=linux/386
          - --label=org.opencontainers.image.created={{.Date}}
          - --label=org.opencontainers.image.name={{.ProjectName}}
          - --label=org.opencontainers.image.revision={{.FullCommit}}
          - --label=org.opencontainers.image.version={{.Version}}
          - --label=org.opencontainers.image.source={{.GitURL}}
    - goos: linux
      goarch: amd64
      image_templates:
          - ghcr.io/liatrio/liatrio-otel-collector:{{ .Version }}-amd64
          - ghcr.io/liatrio/liatrio-otel-collector:latest-amd64
      extra_files:
          - testconfig/config.yaml
      build_flag_templates:
          - --pull
          - --platform=linux/amd64
          - --label=org.opencontainers.image.created={{.Date}}
          - --label=org.opencontainers.image.name={{.ProjectName}}
          - --label=org.opencontainers.image.revision={{.FullCommit}}
          - --label=org.opencontainers.image.version={{.Version}}
          - --label=org.opencontainers.image.source={{.GitURL}}
    - goos: linux
      goarch: arm64
      image_templates:
          - ghcr.io/liatrio/liatrio-otel-collector:{{ .Version }}-arm64
          - ghcr.io/liatrio/liatrio-otel-collector:latest-arm64
      extra_files:
          - testconfig/config.yaml
      build_flag_templates:
          - --pull
          - --platform=linux/arm64
          - --label=org.opencontainers.image.created={{.Date}}
          - --label=org.opencontainers.image.name={{.ProjectName}}
          - --label=org.opencontainers.image.revision={{.FullCommit}}
          - --label=org.opencontainers.image.version={{.Version}}
          - --label=org.opencontainers.image.source={{.GitURL}}
        #docker_manifests:
        #    - name_template: otel/opentelemetry-collector:{{ .Version }}
        #      image_templates:
        #        - otel/opentelemetry-collector:{{ .Version }}-386
        #        - otel/opentelemetry-collector:{{ .Version }}-amd64
        #        - otel/opentelemetry-collector:{{ .Version }}-arm64
        #        - otel/opentelemetry-collector:{{ .Version }}-ppc64le
        #    - name_template: otel/opentelemetry-collector:latest
        #      image_templates:
        #        - otel/opentelemetry-collector:latest-386
        #        - otel/opentelemetry-collector:latest-amd64
        #        - otel/opentelemetry-collector:latest-arm64
        #        - otel/opentelemetry-collector:latest-ppc64le
        #    - name_template: ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector:{{ .Version }}
        #      image_templates:
        #        - ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector:{{ .Version }}-386
        #        - ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector:{{ .Version }}-amd64
        #        - ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector:{{ .Version }}-arm64
        #        - ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector:{{ .Version }}-ppc64le
        #    - name_template: ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector:latest
        #      image_templates:
        #        - ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector:latest-386
        #        - ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector:latest-amd64
        #        - ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector:latest-arm64
        #        - ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector:latest-ppc64le
        #    - name_template: otel/opentelemetry-collector-contrib:{{ .Version }}
        #      image_templates:
        #        - otel/opentelemetry-collector-contrib:{{ .Version }}-386
        #        - otel/opentelemetry-collector-contrib:{{ .Version }}-amd64
        #        - otel/opentelemetry-collector-contrib:{{ .Version }}-arm64
        #        - otel/opentelemetry-collector-contrib:{{ .Version }}-ppc64le
        #    - name_template: otel/opentelemetry-collector-contrib:latest
        #      image_templates:
        #        - otel/opentelemetry-collector-contrib:latest-386
        #        - otel/opentelemetry-collector-contrib:latest-amd64
        #        - otel/opentelemetry-collector-contrib:latest-arm64
        #        - otel/opentelemetry-collector-contrib:latest-ppc64le
        #    - name_template: ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector-contrib:{{ .Version }}
        #      image_templates:
        #        - ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector-contrib:{{ .Version }}-386
        #        - ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector-contrib:{{ .Version }}-amd64
        #        - ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector-contrib:{{ .Version }}-arm64
        #        - ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector-contrib:{{ .Version }}-ppc64le
        #    - name_template: ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector-contrib:latest
        #      image_templates:
        #        - ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector-contrib:latest-386
        #        - ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector-contrib:latest-amd64
        #        - ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector-contrib:latest-arm64
        #        - ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector-contrib:latest-ppc64le


archives:
    - format: tar.gz
    # this name template makes the OS and Arch compatible with the results of uname.
      name_template: >-
          {{ .ProjectName }}_
          {{- title .Os }}_
          {{- if eq .Arch "amd64" }}x86_64
          {{- else if eq .Arch "386" }}i386
          {{- else }}{{ .Arch }}{{ end }}
          {{- if .Arm }}v{{ .Arm }}{{ end }}
    # use zip for windows archives
      format_overrides:
          - goos: windows
            format: zip
checksum:
    name_template: checksums.txt
snapshot:
    name_template: '{{ incpatch .Version }}-next'
changelog:
    sort: asc
    filters:
        exclude:
            - '^docs:'
            - '^test:'

# The lines beneath this are called `modelines`. See `:help modeline`
# Feel free to remove those if you don't want/use them.
# yaml-language-server: $schema=https://goreleaser.com/static/schema.json
# vim: set ts=2 sw=2 tw=0 fo=cnqoj
